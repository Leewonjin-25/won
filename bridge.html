<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì „êµ­ êµëŸ‰ í˜„í™© ì‹¤ì‹œê°„ ê²€ìƒ‰</title>
    <style>
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; background-color: #f8f9fa; color: #333; }
        .container { max-width: 1100px; margin: auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px; }
        
        /* ê²€ìƒ‰ì°½ ë””ìì¸ */
        .search-panel { display: flex; gap: 10px; flex-wrap: wrap; background: #e9ecef; padding: 20px; border-radius: 8px; justify-content: center; margin-bottom: 20px; }
        select { padding: 10px; border: 1px solid #ced4da; border-radius: 5px; min-width: 170px; }
        button { padding: 10px 25px; background-color: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        button:hover { background-color: #0056b3; }
        
        /* í…Œì´ë¸” ë””ìì¸ */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #dee2e6; padding: 12px; text-align: left; }
        th { background-color: #343a40; color: white; position: sticky; top: 0; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        .status-msg { text-align: center; margin-top: 10px; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>ğŸŒ‰ ì „êµ­ êµëŸ‰ í˜„í™© ê²€ìƒ‰ (ì‹¤ì‹œê°„ API)</h1>

    <div class="search-panel">
        <select id="sidoSelect"><option value="">ì§€ì—­(ì‹œë„) ì„ íƒ</option></select>
        <select id="roadSelect"><option value="">ë„ë¡œëª… ì„ íƒ</option></select>
        <select id="structSelect"><option value="">ìƒë¶€êµ¬ì¡° ì„ íƒ</option></select>
        <button onclick="filterResults()">ê²€ìƒ‰</button>
    </div>

    <div id="status" class="status-msg">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
    <div id="count" style="margin-bottom: 5px; font-size: 0.9em; color: #666;"></div>

    <table id="resultTable">
        <thead>
            <tr>
                <th>ì‹œì„¤ë¬¼ëª…</th>
                <th>ì‹œë„ëª…</th>
                <th>ë…¸ì„ ëª…</th>
                <th>ìƒë¶€êµ¬ì¡°í˜•ì‹</th>
            </tr>
        </thead>
        <tbody id="resultBody"></tbody>
    </table>
</div>

<script>
    // 1. ì„¤ì •: ì¸ì¦í‚¤ì™€ URL
    const SERVICE_KEY = '844263b18fcd9deb425afdc7c2e94ecd261979d7b78ac7d4efc3621b9da183f6'; 
    const API_URL = `https://api.odcloud.kr/api/15081953/v1/uddi:b3633094-1a29-43c2-a877-6c84c7811202?page=1&perPage=2000&serviceKey=${SERVICE_KEY}`;

    let bridgeData = [];

    // 2. API ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    async function fetchApiData() {
        try {
            const response = await fetch(API_URL);
            if (!response.ok) throw new Error('API í˜¸ì¶œ ì‹¤íŒ¨ (í‚¤ ë˜ëŠ” ê¶Œí•œ í™•ì¸)');
            
            const result = await response.json();
            bridgeData = result.data; // API ë¬¸ì„œìƒ ë°ì´í„°ëŠ” 'data' í•„ë“œì— ë‹´ê²¨ ìˆìŒ

            document.getElementById('status').style.display = 'none';
            setupFilters();
        } catch (error) {
            document.getElementById('status').innerText = 'ì˜¤ë¥˜: ' + error.message;
            document.getElementById('status').style.color = 'red';
        }
    }

    // 3. ì„ íƒí˜•(ë“œë¡­ë‹¤ìš´) ë©”ë‰´ êµ¬ì„±
    function setupFilters() {
        const sidos = [...new Set(bridgeData.map(b => b['ì‹œë„ëª…']))].filter(Boolean).sort();
        const roads = [...new Set(bridgeData.map(b => b['ë…¸ì„ ëª…']))].filter(Boolean).sort();
        const structs = [...new Set(bridgeData.map(b => b['ìƒë¶€êµ¬ì¡°í˜•ì‹']))].filter(Boolean).sort();

        fillOptions('sidoSelect', sidos);
        fillOptions('roadSelect', roads);
        fillOptions('structSelect', structs);
    }

    function fillOptions(id, items) {
        const select = document.getElementById(id);
        items.forEach(item => {
            const opt = document.createElement('option');
            opt.value = item;
            opt.textContent = item;
            select.appendChild(opt);
        });
    }

    // 4. í•„í„°ë§ ë° í™”ë©´ ì¶œë ¥
    function filterResults() {
        const sido = document.getElementById('sidoSelect').value;
        const road = document.getElementById('roadSelect').value;
        const struct = document.getElementById('structSelect').value;

        const filtered = bridgeData.filter(b => {
            return (!sido || b['ì‹œë„ëª…'] === sido) &&
                   (!road || b['ë…¸ì„ ëª…'] === road) &&
                   (!struct || b['ìƒë¶€êµ¬ì¡°í˜•ì‹'] === struct);
        });

        displayTable(filtered);
    }

    function displayTable(data) {
        const tbody = document.getElementById('resultBody');
        const countDisp = document.getElementById('count');
        tbody.innerHTML = '';
        countDisp.innerText = `ê²€ìƒ‰ ê²°ê³¼: ${data.length}ê±´`;

        data.forEach(b => {
            const row = `<tr>
                <td>${b['ì‹œì„¤ë¬¼ëª…']}</td>
                <td>${b['ì‹œë„ëª…']}</td>
                <td>${b['ë…¸ì„ ëª…']}</td>
                <td>${b['ìƒë¶€êµ¬ì¡°í˜•ì‹']}</td>
            </tr>`;
            tbody.innerHTML += row;
        });

        if (data.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;">ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” êµëŸ‰ì´ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
        }
    }

    // í˜ì´ì§€ ì‹œì‘ ì‹œ í˜¸ì¶œ
    fetchApiData();
</script>

</body>
</html>
