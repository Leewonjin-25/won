<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>ë°°ë¦¬ì–´í”„ë¦¬ ë¬¸í™”ê´€ê´‘ ì§€ë„</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_APP_KEY"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<style>
body{font-family:sans-serif;background:#f4f7f6;padding:20px}
.container{max-width:900px;margin:auto;background:#fff;padding:20px;border-radius:10px}
.filter-group{display:flex;flex-wrap:wrap;gap:8px}
select,button{padding:10px;border-radius:6px;border:1px solid #ccc;flex:1}
button{background:#4A90E2;color:#fff;border:none;font-weight:bold;cursor:pointer}
#map{width:100%;height:350px;margin-top:15px;border-radius:8px}
.place-item{padding:12px;border-bottom:1px solid #eee;cursor:pointer}
.place-item:hover{background:#f0f7ff}
#load-more-btn{width:100%;padding:10px;border:none;display:none}
.guide{text-align:center;color:#888;padding:20px}
</style>
</head>
<body>
<div class="container">
<h2>â™¿ ë°°ë¦¬ì–´í”„ë¦¬ ë¬¸í™”ê´€ê´‘ íƒë°©</h2>

<div class="filter-group">
<select id="sidoSelect" onchange="updateGugun()"><option value="">ì‹œ/ë„ ì„ íƒ</option></select>
<select id="gugunSelect"><option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option></select>
<select id="cat1Select"><option value="">ëŒ€ë¶„ë¥˜</option></select>
<select id="cat2Select"><option value="">ì¤‘ë¶„ë¥˜</option></select>
<button onclick="searchPlaces()">ì¡°íšŒí•˜ê¸°</button>
</div>

<div id="map"></div>

<div id="info-list">
<p class="guide">ì¡°ê±´ì„ ì„ íƒí•˜ê³  ì¡°íšŒí•˜ê¸°ë¥¼ ëˆ„ë¥´ì„¸ìš”.</p>
</div>
<button id="load-more-btn" onclick="loadMore()">ë”ë³´ê¸° â–¾</button>
</div>

<script>
let allData=[];
let filteredData=[];
let currentIndex=0;
const PAGE_SIZE=10;
let map;

// -------- CSV ë¡œë“œ --------
Papa.parse("í•œêµ­ë¬¸í™”ì •ë³´ì›_ì „êµ­ ë°°ë¦¬ì–´í”„ë¦¬ ë¬¸í™”ì˜ˆìˆ ê´€ê´‘ì§€_20221125.csv",{
 download:true,
 header:true,
 complete:(res)=>{
   allData = res.data.filter(d=>d.ì‹œì„¤ëª… && d.ìœ„ë„ && d.ê²½ë„);
   initSido();
   initCategory();
   initMap(37.5665,126.9780);
 }
});

// -------- ì‹œ/ë„ --------
function initSido(){
 const sidos=[...new Set(allData.map(d=>d["ì‹œë„ ëª…ì¹­"]).filter(Boolean))].sort();
 const el=document.getElementById("sidoSelect");
 sidos.forEach(s=>{
   const o=document.createElement("option");
   o.value=s;o.textContent=s;el.appendChild(o);
 });
}

// -------- ì‹œ/êµ°/êµ¬ --------
function updateGugun(){
 const sido=document.getElementById("sidoSelect").value;
 const el=document.getElementById("gugunSelect");
 el.innerHTML=`<option value="">ì‹œ/êµ°/êµ¬ ì„ íƒ</option>`;
 if(!sido)return;
 const list=[...new Set(allData.filter(d=>d["ì‹œë„ ëª…ì¹­"]===sido).map(d=>d["ì‹œêµ°êµ¬ ëª…ì¹­"]).filter(Boolean))].sort();
 list.forEach(g=>{
   const o=document.createElement("option");
   o.value=g;o.textContent=g;el.appendChild(o);
 });
}

// -------- ì¹´í…Œê³ ë¦¬ --------
function initCategory(){
 const cat1=[...new Set(allData.map(d=>d["ì¹´í…Œê³ ë¦¬1"]).filter(Boolean))].sort();
 const cat1El=document.getElementById("cat1Select");
 const cat2El=document.getElementById("cat2Select");

 cat1.forEach(c=>{
   const o=document.createElement("option");
   o.value=c;o.textContent=c;cat1El.appendChild(o);
 });

 cat1El.onchange=function(){
   const v=this.value;
   cat2El.innerHTML=`<option value="">ì¤‘ë¶„ë¥˜</option>`;
   const list=[...new Set(allData.filter(d=>d["ì¹´í…Œê³ ë¦¬1"]===v).map(d=>d["ì¹´í…Œê³ ë¦¬2"]).filter(Boolean))].sort();
   list.forEach(c=>{
     const o=document.createElement("option");
     o.value=c;o.textContent=c;cat2El.appendChild(o);
   });
 };
}

// -------- ì§€ë„ --------
function initMap(lat,lng){
 map=new kakao.maps.Map(document.getElementById("map"),{
   center:new kakao.maps.LatLng(lat,lng),level:8
 });
}
function moveTo(lat,lng){
 const pos=new kakao.maps.LatLng(parseFloat(lat),parseFloat(lng));
 map.panTo(pos);
 new kakao.maps.Marker({map,position:pos});
}

// -------- ê²€ìƒ‰ --------
function searchPlaces(){
 const sido=sidoSelect.value;
 const gugun=gugunSelect.value;
 const c1=cat1Select.value;
 const c2=cat2Select.value;

 filteredData = allData.filter(d=>
   (!sido||d["ì‹œë„ ëª…ì¹­"]===sido) &&
   (!gugun||d["ì‹œêµ°êµ¬ ëª…ì¹­"]===gugun) &&
   (!c1||d["ì¹´í…Œê³ ë¦¬1"]===c1) &&
   (!c2||d["ì¹´í…Œê³ ë¦¬2"]===c2)
 );

 currentIndex=0;
 infoList.innerHTML="";
 if(filteredData.length===0){
   infoList.innerHTML=`<p class="guide">ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
   loadMoreBtn.style.display="none";
   return;
 }
 renderNext();
 moveTo(filteredData[0].ìœ„ë„,filteredData[0].ê²½ë„);
}

// -------- ëª©ë¡ --------
function renderNext(){
 const part=filteredData.slice(currentIndex,currentIndex+PAGE_SIZE);
 part.forEach(d=>{
   const div=document.createElement("div");
   div.className="place-item";
   div.innerHTML=`<b>${d.ì‹œì„¤ëª…}</b> <small>${d["ì¹´í…Œê³ ë¦¬2"]||""}</small>`;
   div.onclick=()=>moveTo(d.ìœ„ë„,d.ê²½ë„);
   infoList.appendChild(div);
 });
 currentIndex+=PAGE_SIZE;
 loadMoreBtn.style.display = currentIndex<filteredData.length ? "block":"none";
}
function loadMore(){renderNext();}
 <div id="info-list">
    <p class="guide">ì§€ì—­ê³¼ ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•œ í›„ ì¡°íšŒí•˜ê¸°ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p>
</div>

<button id="load-more-btn" onclick="loadMore()" style="display:none;">ë”ë³´ê¸° â–¾</button>

<div class="action-group">
    <button onclick="goToPlanner()" class="plan-btn">ğŸ—“ï¸ ë‚˜ë§Œì˜ ì—¬í–‰ ê³„íší‘œ ë§Œë“¤ê¸°</button>
</div>
</script>
</body>
</html>
