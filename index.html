<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>배리어프리 문화관광 지도</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="//dapi.kakao.com/v2/maps/sdk.js?appkey=YOUR_KAKAO_APP_KEY"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
<style>
body{font-family:sans-serif;background:#f4f7f6;padding:20px}
.container{max-width:900px;margin:auto;background:#fff;padding:20px;border-radius:10px}
.filter-group{display:flex;flex-wrap:wrap;gap:8px}
select,button{padding:10px;border-radius:6px;border:1px solid #ccc;flex:1}
button{background:#4A90E2;color:#fff;border:none;font-weight:bold;cursor:pointer}
#map{width:100%;height:350px;margin-top:15px;border-radius:8px}
.place-item{padding:12px;border-bottom:1px solid #eee;cursor:pointer}
.place-item:hover{background:#f0f7ff}
#load-more-btn{width:100%;padding:10px;border:none;display:none}
.guide{text-align:center;color:#888;padding:20px}
</style>
</head>
<body>
<div class="container">
<h2>♿ 배리어프리 문화관광 탐방</h2>

<div class="filter-group">
<select id="sidoSelect" onchange="updateGugun()"><option value="">시/도 선택</option></select>
<select id="gugunSelect"><option value="">시/군/구 선택</option></select>
<select id="cat1Select"><option value="">대분류</option></select>
<select id="cat2Select"><option value="">중분류</option></select>
<button onclick="searchPlaces()">조회하기</button>
</div>

<div id="map"></div>

<div id="info-list">
<p class="guide">조건을 선택하고 조회하기를 누르세요.</p>
</div>
<button id="load-more-btn" onclick="loadMore()">더보기 ▾</button>
</div>

<script>
let allData=[];
let filteredData=[];
let currentIndex=0;
const PAGE_SIZE=10;
let map;

// -------- CSV 로드 --------
Papa.parse("한국문화정보원_전국 배리어프리 문화예술관광지_20221125.csv",{
 download:true,
 header:true,
 complete:(res)=>{
   allData = res.data.filter(d=>d.시설명 && d.위도 && d.경도);
   initSido();
   initCategory();
   initMap(37.5665,126.9780);
 }
});

// -------- 시/도 --------
function initSido(){
 const sidos=[...new Set(allData.map(d=>d["시도 명칭"]).filter(Boolean))].sort();
 const el=document.getElementById("sidoSelect");
 sidos.forEach(s=>{
   const o=document.createElement("option");
   o.value=s;o.textContent=s;el.appendChild(o);
 });
}

// -------- 시/군/구 --------
function updateGugun(){
 const sido=document.getElementById("sidoSelect").value;
 const el=document.getElementById("gugunSelect");
 el.innerHTML=`<option value="">시/군/구 선택</option>`;
 if(!sido)return;
 const list=[...new Set(allData.filter(d=>d["시도 명칭"]===sido).map(d=>d["시군구 명칭"]).filter(Boolean))].sort();
 list.forEach(g=>{
   const o=document.createElement("option");
   o.value=g;o.textContent=g;el.appendChild(o);
 });
}

// -------- 카테고리 --------
function initCategory(){
 const cat1=[...new Set(allData.map(d=>d["카테고리1"]).filter(Boolean))].sort();
 const cat1El=document.getElementById("cat1Select");
 const cat2El=document.getElementById("cat2Select");

 cat1.forEach(c=>{
   const o=document.createElement("option");
   o.value=c;o.textContent=c;cat1El.appendChild(o);
 });

 cat1El.onchange=function(){
   const v=this.value;
   cat2El.innerHTML=`<option value="">중분류</option>`;
   const list=[...new Set(allData.filter(d=>d["카테고리1"]===v).map(d=>d["카테고리2"]).filter(Boolean))].sort();
   list.forEach(c=>{
     const o=document.createElement("option");
     o.value=c;o.textContent=c;cat2El.appendChild(o);
   });
 };
}

// -------- 지도 --------
function initMap(lat,lng){
 map=new kakao.maps.Map(document.getElementById("map"),{
   center:new kakao.maps.LatLng(lat,lng),level:8
 });
}
function moveTo(lat,lng){
 const pos=new kakao.maps.LatLng(parseFloat(lat),parseFloat(lng));
 map.panTo(pos);
 new kakao.maps.Marker({map,position:pos});
}

// -------- 검색 --------
function searchPlaces(){
 const sido=sidoSelect.value;
 const gugun=gugunSelect.value;
 const c1=cat1Select.value;
 const c2=cat2Select.value;

 filteredData = allData.filter(d=>
   (!sido||d["시도 명칭"]===sido) &&
   (!gugun||d["시군구 명칭"]===gugun) &&
   (!c1||d["카테고리1"]===c1) &&
   (!c2||d["카테고리2"]===c2)
 );

 currentIndex=0;
 infoList.innerHTML="";
 if(filteredData.length===0){
   infoList.innerHTML=`<p class="guide">결과가 없습니다.</p>`;
   loadMoreBtn.style.display="none";
   return;
 }
 renderNext();
 moveTo(filteredData[0].위도,filteredData[0].경도);
}

// -------- 목록 --------
function renderNext(){
 const part=filteredData.slice(currentIndex,currentIndex+PAGE_SIZE);
 part.forEach(d=>{
   const div=document.createElement("div");
   div.className="place-item";
   div.innerHTML=`<b>${d.시설명}</b> <small>${d["카테고리2"]||""}</small>`;
   div.onclick=()=>moveTo(d.위도,d.경도);
   infoList.appendChild(div);
 });
 currentIndex+=PAGE_SIZE;
 loadMoreBtn.style.display = currentIndex<filteredData.length ? "block":"none";
}
function loadMore(){renderNext();}
</script>
</body>
</html>
